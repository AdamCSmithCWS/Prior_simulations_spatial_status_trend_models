---
title: "Prior Simulations for status and trend models"
author: "Adam C. Smith"
date: "30/10/2022"
output: pdf_document
---

```{r setup, message=FALSE,echo=FALSE,error=TRUE}
options(scipen=99999)
library(tidyverse)
library(cmdstanr)
library(mgcv) 
library(patchwork)
library(kableExtra)
library(bbsBayes)

```

# Prior Simulation of parameters that control the population trajectories in spatial status and trend models

## Priors for the annual differences in a first-difference model
### Priors for the SD of these parameters among strata


## Priors for the spline parameters in a thin-plate regression spline basis
### Priors for the SD of these parameters among strata

```{r simulated_condictions, include=FALSE, echo=FALSE}

tb_sims <- data.frame(model = c(rep("gamye",2),
                                rep("first_difference",3)),
                      spatial = c(FALSE,TRUE,
                                  FALSE,FALSE,TRUE),
                      hierarchical = c(TRUE,TRUE,
                                       FALSE,TRUE,TRUE),
                      model_file = c("gamye_non_spatial_prior_sim.stan",
                                "gamye_spatial_prior_sim.stan",
                                "first_difference_non_hierarchical_prior_sim.stan",
                                "first_difference_non_spatial_prior_sim.stan",
                                "first_difference_spatial_prior_sim.stan"),
                      prior_time = c(1,1,
                                    NA,0.1,0.1),
                      prior_sd_time = c(1,1,
                                        0.3,0.1,0.1),
                      prior_yeareffects = c(10,10,
                                        NA,NA,NA))


strat_data <- bbsBayes::stratify(by = "bbs_usgs")
# source("functions/prepare-data-Stan.R") # overwrites the bbsBayes prepare_data function

base_data <- bbsBayes::prepare_data(strat_data,
                         species_to_run = "Wood Thrush",
                         model = "gamye",
                         min_n_routes = 1,
                         basis = "mgcv")

strat_df <- data.frame(strat = base_data$strat,
                       strat_name = base_data$strat_name,
                       ST_12 = base_data$strat_name) %>% 
  distinct()
source("functions/neighbours_define.R")

strat_map <- bbsBayes::load_map("bbs_usgs") %>% 
  inner_join(.,strat_df,by = "ST_12")

strat_neighbours <- neighbours_define(strat_map,
                                      species = "simulated",
                                      plot_dir = "maps/",
                                      strat_indicator = "strat")

 
    nstrata = max(strat_df$strat)
      nyears = max(base_data$ymax)
      nyears_m1 = nyears-1
      midyear = floor(nyears/2)
  
      N_edges = strat_neighbours$N_edges
      node1 = strat_neighbours$node1
      node2 = strat_neighbours$node2
      
      Iy1 = c((midyear-1):1)
      Iy2 = c((midyear+1):nyears)
      nIy1 = length(Iy1)
      nIy2 = length(Iy2)
      
      nknots_year <- base_data$nknots
      year_basis <- base_data$X.basis

data_gamye <- list(
        nstrata = nstrata,
        nyears = nyears,
        nyears_m1 = nyears_m1,
        
        #spatial structure
        N_edges = N_edges,
        node1 = node1,
        node2 = node2,
        
        # gam parameters
        nknots_year = nknots_year,
        year_basis = year_basis,
                
        pnorm = 1, #sd prior for among strata trend is half t-distribution instead of half-normal (if pnorm == 1)

        df = 3 #prior is half t-distribution with this df
  
)

data_diff <- list(
        nstrata = nstrata,
        nyears = nyears,
        nyears_m1 = nyears_m1,
        
        #spatial structure
        N_edges = N_edges,
        node1 = node1,
        node2 = node2,
        
        #temporal indexing
        midyear =  midyear,
        Iy1 = Iy1,
        Iy2 = Iy2,
        nIy1 = nIy1,
        nIy2 = nIy2,
        
        #vector of zeros to fill midyear beta values
        zero_betas = rep(0,nstrata),
        
        pnorm = 1, #sd prior for among strata trend is half t-distribution instead of half-normal (if pnorm == 1)
        df = 3 #prior is half t-distribution with this df
  
)


```



```{r simulations,eval=FALSE}

for(i in 1:nrow(tb_sims)){
  mod <- tb_sims[i,"model"]
  prior_B <- tb_sims[i,"prior_time"]
  prior_b <- tb_sims[i,"prior_sd_time"]
  prior_y <- tb_sims[i,"prior_yeareffects"]
  
  if(mod == "gamye"){
    stan_data <- data_gamye
    stan_data[["prior_scale_y"]] <- prior_y
  
  }else{
    stan_data <- data_diff
    
  }
  
  stan_data[["prior_scale_b"]] <- prior_b
  
  if(tb_sims[i,"hierarchical"]){
    hier <- ""
    stan_data[["prior_scale_B"]] <- prior_B

    if(tb_sims[i,"spatial"]){
      spat <- "spatial"
      
    }else{
    spat <- "non_spatial"
      stan_data[["N_edges"]] <- NULL
      stan_data[["node1"]] <- NULL
      stan_data[["node2"]] <- NULL
      
    }
  
  }else{
    hier <- "non_hierarchical"
    spat <- ""
     stan_data[["N_edges"]] <- NULL
      stan_data[["node1"]] <- NULL
      stan_data[["node2"]] <- NULL
     
  }

  
  out_base <- paste("prior_sim",mod,spat,hier,sep = "_")
  

  mod_file <- paste0("models/",tb_sims[i,"model_file"])
        
      # Fit model ---------------------------------------------------------------
      
      print(paste("beginning",out_base,Sys.time()))
      
   
      ## compile model
      model <- cmdstan_model(mod_file)
      
      
      # Initial Values ----------------------------------------------------------
      
      
      # init_def <- function(){ list(sdbeta = runif(nyears_m1,0.01,0.1),
      #                              beta_raw = matrix(rnorm(nyears_m1*nstrata,0,0.01),nrow = nstrata,ncol = nyears_m1),
      #                              sdBETA = runif(1,0.01,0.1),
      #                              BETA_raw = rnorm(nyears_m1,0,0.01))}
      
      stanfit <- model$sample(
        data=stan_data,
        refresh=100,
        chains=2, iter_sampling=1000,
        iter_warmup=500,
        parallel_chains = 2,
        #pars = parms,
        adapt_delta = 0.8,
        max_treedepth = 10,
        seed = 123)
      
      
      stanfit$save_object(file = paste0("output/",out_base,".rds"))
      
      
      

      

}


```







We then summarized the estimated trajectories as well as the 1, 5, 10, 20, and 50-year trends simulated from the alternative priors.

```{r summarising,eval=FALSE}
source("Functions/posterior_summary_functions.R")

n_out <- NULL
trends_out <- NULL
summ_out <- NULL




for(i in 1:nrow(tb_sims)){
  
  trends_out_tmp <- NULL

  mod <- tb_sims[i,"model"]
  prior_B <- tb_sims[i,"prior_time"]
  prior_b <- tb_sims[i,"prior_sd_time"]
  prior_y <- tb_sims[i,"prior_yeareffects"]
  

  if(tb_sims[i,"hierarchical"]){
    hier <- ""

    if(tb_sims[i,"spatial"]){
      spat <- "spatial"
      
    }else{
    spat <- "non_spatial"

    }
  
  }else{
    hier <- "non_hierarchical"
    spat <- ""
  }

  
  out_base <- paste("prior_sim",mod,spat,hier,sep = "_")
  
  stanfit <- readRDS(paste0("output/",out_base,".rds"))


summ = stanfit$summary()

summ <- summ %>% 
  mutate(model = mod,
         spatial = spat,
         hierarchical = hier)

n_samples <- posterior_samples(stanfit,
                                 parm = "n",
                                 dims = c("strat","Year_Index"))


if(mod == "gamye"){
nsmooth_samples <- posterior_samples(stanfit,
                                 parm = "nsmooth",
                                 dims = c("strat","Year_Index"))
  

# N_samples <- posterior_samples(stanfit,
#                                  parm = "NSMOOTH",
#                                  dims = c("Year_Index"))

}





nyears = max(n_samples$Year_Index)
# function to calculate a %/year trend from a count-scale trajectory
trs <- function(y1,y2,ny){
  tt <- (((y2/y1)^(1/ny))-1)*100
}


for(tl in c(2,6,11,21,51)){ #estimating all possible 1-year, 10-year, and full trends
  ny = tl-1
  yrs1 <- seq(1,(nyears-ny),by = ny)
  yrs2 <- yrs1+ny
  for(j in 1:length(yrs1)){
    y2 <- yrs2[j]
    y1 <- yrs1[j]
    
nyh2 <- paste0("Y",y2)
nyh1 <- paste0("Y",y1)
trends <- n_samples %>% 
  filter(Year_Index %in% c(y1,y2)) %>% 
  select(.draw,.value,Year_Index,strat) %>% 
  group_by(.draw,Year_Index) %>% 
  summarise(.value = mean(.value),
            .groups = "keep") %>% 
  pivot_wider(.,names_from = Year_Index,
              values_from = .value,
              names_prefix = "Y") %>%
  rename_with(.,~gsub(pattern = nyh2,replacement = "YE", .x)) %>% 
  rename_with(.,~gsub(pattern = nyh1,replacement = "YS", .x)) %>% 
  group_by(.draw) %>% 
  summarise(trend = trs(YS,YE,ny),
            .groups = "keep")%>% 
  mutate(model = mod,
         spatial = spat,
         hierarchical = hier,
         first_year = y1,
         last_year = y2,
         nyears = ny,
         scale = "Survey_Wide",
         type = "full")



trends_out_tmp <- bind_rows(trends_out_tmp,trends)

trends <- n_samples %>% 
  filter(Year_Index %in% c(y1,y2)) %>% 
  select(.draw,.value,Year_Index,strat) %>% 
  pivot_wider(.,names_from = Year_Index,
              values_from = .value,
              names_prefix = "Y") %>%
  rename_with(.,~gsub(pattern = nyh2,replacement = "YE", .x)) %>% 
  rename_with(.,~gsub(pattern = nyh1,replacement = "YS", .x)) %>% 
  group_by(.draw,strat,
            .groups = "keep") %>% 
  summarise(trend = trs(YS,YE,ny),
            .groups = "keep")%>% 
  mutate(model = mod,
         spatial = spat,
         hierarchical = hier,
         first_year = y1,
         last_year = y2,
         nyears = ny,
         scale = "Regional",
         type = "full")

trends_out_tmp <- bind_rows(trends_out_tmp,trends)


if(mod == "gamye"){
  trends <- nsmooth_samples %>% 
  filter(Year_Index %in% c(y1,y2)) %>% 
  select(.draw,.value,Year_Index,strat) %>% 
  group_by(.draw,Year_Index) %>% 
  summarise(.value = mean(.value),
            .groups = "keep") %>% 
  pivot_wider(.,names_from = Year_Index,
              values_from = .value,
              names_prefix = "Y") %>%
  rename_with(.,~gsub(pattern = nyh2,replacement = "YE", .x)) %>% 
  rename_with(.,~gsub(pattern = nyh1,replacement = "YS", .x)) %>% 
  group_by(.draw) %>% 
  summarise(trend = trs(YS,YE,ny),
            .groups = "keep")%>% 
  mutate(model = mod,
         spatial = spat,
         hierarchical = hier,
         first_year = y1,
         last_year = y2,
         nyears = ny,
         scale = "Survey_Wide",
         type = "smooth")



trends_out_tmp <- bind_rows(trends_out_tmp,trends)

trends <- nsmooth_samples %>% 
  filter(Year_Index %in% c(y1,y2)) %>% 
  select(.draw,.value,Year_Index,strat) %>% 
  pivot_wider(.,names_from = Year_Index,
              values_from = .value,
              names_prefix = "Y") %>%
  rename_with(.,~gsub(pattern = nyh2,replacement = "YE", .x)) %>% 
  rename_with(.,~gsub(pattern = nyh1,replacement = "YS", .x)) %>% 
  group_by(.draw,strat) %>% 
  summarise(trend = trs(YS,YE,ny),
            .groups = "keep")%>% 
  mutate(model = mod,
         spatial = spat,
         hierarchical = hier,
         first_year = y1,
         last_year = y2,
         nyears = ny,
         scale = "Regional",
         type = "smooth")
trends_out_tmp <- bind_rows(trends_out_tmp,trends)


}

}
}
save(file = paste0("output/prior_sim_summary",out_base,".RData"),
     list = c("trends_out_tmp",
              "summ"))

summ_out <- bind_rows(summ_out,summ)
trends_out <- bind_rows(trends_out,trends_out_tmp)
  }#prior_scale

saveRDS(trends_out,file = "output/prior_sim_trends.rds")
saveRDS(summ_out,file = "output/prior_sim_summaries.rds")



```





```{r plotting trends}

# loading the stored realised BBS and CBC trend estimates
 all_trends <- readRDS(file = "data/all_trends_bbs_cbc.rds")
all_sw_trends <- all_trends %>% 
  filter(Region == "Survey_Wide")
all_politic_trends <- all_trends %>% 
  filter(Region != "Survey_Wide")

mxabs = 2000#upper limit on the aboslute trend estimates for the density plots below

## loading the prior simulated trends for all models
trends_out <- readRDS("output/prior_sim_trends.rds")


#summarising the trends for the political regions (not survey wide)
prior_trends_politic <- trends_out %>% 
  filter(scale != "Survey_Wide") %>% 
  mutate(abs_trend = abs(trend),
         t_years = paste(nyears,"year trends",sep = "-"),
         t_years = factor(t_years,
                          levels = c("1-year trends",
                                     "5-year trends",
                                     "10-year trends",
                                     "20-year trends",
                                     "50-year trends"),
                          ordered = TRUE),
         model_type = paste(model,spatial,hierarchical,sep = " "))

#setting up plotting label names for the models
mod_types <- unique(prior_trends_politic$model_type)
names(mod_types) <- gsub(mod_types,pattern = "(_)|[[:space:]]{2}",
                         replacement = " ")
realised_all_politic_freq <- vector(mode = "list",length = length(mod_types))
names(realised_all_politic_freq) <- mod_types

#looping through each model to generate the realised vs prior trend density plots
for(i in 1:length(mod_types)){
  mm = mod_types[i]
  mlab = names(mod_types)[i]

     tmp_sim <- prior_trends_politic %>% 
    filter(model_type == mm) 
  
tmp <- ggplot(data = all_politic_trends,
                                 aes(abs_trend,after_stat(density),
                                     groups = Survey))+
  geom_freqpoly(breaks = c(0,seq(0.5,mxabs,0.5)),center = 0,
              colour = grey(0.5))+
  geom_freqpoly(data = tmp_sim,
                aes(abs_trend,after_stat(density),
                colour = model_type),
                inherit.aes = FALSE,
                breaks = c(0,seq(0.5,mxabs,0.5)),center = 0)+
  scale_colour_viridis_d(begin = 0.8)+
  xlab("Absolute value of state/province trends USGS and Audubon models")+
  ylab("")+
  labs(title = paste0("Simulated state/province prior trends from ",mlab,"model"))+
  theme_bw()+
  theme(legend.position = "none")+
  coord_cartesian(ylim = c(0,0.7),
                  xlim = c(0,40))

  if(grepl(pattern = "gam",mm)){ # gamye models need to plots to represent the full and smooth only trend estimates
   tmp <- tmp+facet_wrap(vars(type,t_years),
             nrow = 2,ncol = 5)  
}else{
 tmp <- tmp+facet_wrap(vars(t_years),
             ncol = 5) 
}

realised_all_politic_freq[[mm]] <- tmp

}


# same plots and trend summaries as above, but for the survey-wide estimates
prior_trends_sw <- trends_out %>% 
  filter(scale == "Survey_Wide") %>% 
  mutate(abs_trend = abs(trend),
         t_years = paste(nyears,"year trends",sep = "-"),
         t_years = factor(t_years,
                          levels = c("1-year trends",
                                     "5-year trends",
                                     "10-year trends",
                                     "20-year trends",
                                     "50-year trends"),
                          ordered = TRUE),
         model_type = paste(model,spatial,hierarchical,sep = " "))

realised_all_sw_freq <- vector(mode = "list",length = length(mod_types))
names(realised_all_sw_freq) <- mod_types

# looping through models to generate plots
for(i in 1:length(mod_types)){
  mm = mod_types[i]
  mlab = names(mod_types)[i]
  tmp_sim <- prior_trends_sw %>% 
    filter(model_type == mm)
tmp <- ggplot(data = all_sw_trends,
                                 aes(abs_trend,after_stat(density),
                                     groups = Survey))+
  geom_freqpoly(breaks = c(0,seq(0.5,mxabs,0.5)),center = 0,
              colour = grey(0.5))+
  geom_freqpoly(data = tmp_sim,
                aes(abs_trend,after_stat(density),
                colour = model_type),
                inherit.aes = FALSE,
                breaks = c(0,seq(0.5,mxabs,0.5)),center = 0)+
  scale_colour_viridis_d(begin = 0.8)+
  xlab("Absolute value of survey wide trends USGS and Audubon models")+
  ylab("")+
  labs(title = paste0("Simulated survey wide prior trends from ",mlab,"model"))+
  theme_bw()+
  theme(legend.position = "none")+
  coord_cartesian(ylim = c(0,0.7),
                  xlim = c(0,40))

  if(grepl(pattern = "gam",mm)){
   tmp <- tmp+facet_wrap(vars(type,t_years),
             nrow = 2,ncol = 5) 
 }else{
  tmp <- tmp+facet_wrap(vars(t_years),
             ncol = 5) 
}

realised_all_sw_freq[[mm]] <- tmp

}



```

The code above plots the realised distribution of trends across the full time series of the BBS and CBC (black lines) along with the distribution of trends using the various priors used in the models in this paper. 

\newpage 

### gamye non spatial
The survey wide trends, both full trajectory and the smooth only, from the gamye non-spatial model using half t-distribution with 0 mean, sd = `r tb_sims[1,"prior_time"]`, and 3 degrees of freedom for the standard deviation of the spline parameters that control the wiggliness of the mean population smooth, and the same prior for wiggliness of the strata-level smooths. The standard deviation of the year-effects were given a gamma prior with shape parameter = 2 and scale parameter = `r tb_sims[1,"prior_yeareffects"]`. 
```{r gamye plot 1a}
print(realised_all_sw_freq[[1]])
```
```{r gamye plot 1b}
print(realised_all_politic_freq[[1]])
```


\newpage 

### gamye spatial
The survey wide trends, both full trajectory and the smooth only, from the spatial version of the gamye model using half t-distribution with 0 mean, sd = `r tb_sims[2,"prior_time"]`, and 3 degrees of freedom for the standard deviation of the spline parameters that control the wiggliness of the mean population smooth, and the same prior for the spatial variation among strata on the spline parameters. The standard deviation of the year-effects were given a gamma prior with shape parameter = 2 and scale parameter = `r tb_sims[2,"prior_yeareffects"]`. 
```{r gamye plot 2a}
print(realised_all_sw_freq[[2]])
```
```{r gamye plot 2b}
print(realised_all_politic_freq[[2]])
```


\newpage 

### first difference non hierarchical
The survey wide trends, from the non hierarchical version of the first difference model using half t-distribution with 0 mean, sd = `r tb_sims[3,"prior_sd_time"]`, and 3 degrees of freedom for the standard deviation of the annual differences in abundance in a given stratum. 
```{r gamye plot 3a}
print(realised_all_sw_freq[[3]])
```
```{r gamye plot 3b}
print(realised_all_politic_freq[[3]])
```


\newpage 

### first difference non spatial
The survey wide trends, from the non spatial version of the first difference model using half t-distribution with 0 mean, sd = `r tb_sims[4,"prior_time"]`, and 3 degrees of freedom for the standard deviation of the mean overall annual differences in abundance, and a half t-distribution with a sd = `r tb_sims[4,"prior_sd_time"]` on the variation among strata in the differences. 
```{r gamye plot 4a}
print(realised_all_sw_freq[[4]])
```
```{r gamye plot 4b}
print(realised_all_politic_freq[[4]])
```


\newpage 

### first difference non spatial
The survey wide trends, from the non spatial version of the first difference model using half t-distribution with 0 mean, sd = `r tb_sims[5,"prior_time"]`, and 3 degrees of freedom for the standard deviation of the mean overall annual differences in abundance, and a half t-distribution with a sd = `r tb_sims[5,"prior_sd_time"]` on the spatial variation among strata on the differences. 
```{r gamye plot 5a}
print(realised_all_sw_freq[[5]])
```
```{r gamye plot 5b}
print(realised_all_politic_freq[[5]])
```

\newpage 

## Exploring the standard deviation of trends among regions

```{r sdtrends compile}
realised_all_sd_freq <- vector(mode = "list",length = length(mod_types))
names(realised_all_sd_freq) <- mod_types

## summarizing the sd of realised trends
all_politic_sdtrends <- all_politic_trends %>% 
  filter(Survey %in% c("BBS","CBC")) %>% 
  group_by(Survey,AOU,first_year,last_year,nyears) %>% 
  summarise(sd_trend = sd(trend)) %>% 
  mutate(t_years = paste(nyears,"year trends",sep = "-"),
         t_years = factor(t_years,
                          levels = c("1-year trends",
                                     "5-year trends",
                                     "10-year trends",
                                     "20-year trends",
                                     "50-year trends"),
                          ordered = TRUE))

## loading the prior simulated trends for all models
trends_out <- readRDS("output/prior_sim_trends.rds")

#summarising the trends for the political regions (not survey wide)
prior_sdtrends_politic <- trends_out %>% 
  filter(scale != "Survey_Wide") %>% 
  group_by(.draw,model,spatial,hierarchical,first_year,last_year,nyears,type) %>% 
  summarise(sd_trend = sd(trend)) %>% 
  mutate(t_years = paste(nyears,"year trends",sep = "-"),
         t_years = factor(t_years,
                          levels = c("1-year trends",
                                     "5-year trends",
                                     "10-year trends",
                                     "20-year trends",
                                     "50-year trends"),
                          ordered = TRUE),
         model_type = paste(model,spatial,hierarchical,sep = " "))


# looping through models to generate plots
for(i in 1:length(mod_types)){
  mm = mod_types[i]
  mlab = names(mod_types)[i]
  tmp_sim <- prior_sdtrends_politic %>% 
    filter(model_type == mm)
tmp <- ggplot(data = all_politic_sdtrends,
                                 aes(sd_trend,after_stat(density),
                                     groups = Survey))+
  geom_freqpoly(breaks = c(seq(-mxabs,mxabs,0.5)),center = 0,
              colour = grey(0.5))+
  geom_freqpoly(data = tmp_sim,
    aes(sd_trend,after_stat(density),
    colour = model_type),
    inherit.aes = FALSE,
    breaks = c(seq(-mxabs,mxabs,0.5)),center = 0)+
  scale_colour_viridis_d(begin = 0.8)+
  xlab("SD of survey wide trends USGS and Audubon models")+
  ylab("")+
  labs(title = paste0("SD of simulated survey wide prior trends from ",mlab,"model"))+
  theme_bw()+
  theme(legend.position = "none")+
  coord_cartesian(ylim = c(0,0.7),
                  xlim = c(0,40))

  if(grepl(pattern = "gam",mm)){
   tmp <- tmp+facet_wrap(vars(type,t_years),
             nrow = 2,ncol = 5) 
 }else{
  tmp <- tmp+facet_wrap(vars(t_years),
             ncol = 5) 
}

realised_all_sd_freq[[mm]] <- tmp

}


```


The code above plots the realised distribution of the standard deviation of trends among regions within species for all possible time-windows across the full time series of the BBS and CBC (black lines) along with the distribution of standard deviation of trends from the various priors used in the models in this paper. 

\newpage 

### gamye non spatial
The survey wide trends, both full trajectory and the smooth only, from the gamye non-spatial model using half t-distribution with 0 mean, sd = `r tb_sims[1,"prior_time"]`, and 3 degrees of freedom for the standard deviation of the spline parameters that control the wiggliness of the mean population smooth, and the same prior for wiggliness of the strata-level smooths. The standard deviation of the year-effects were given a gamma prior with shape parameter = 2 and scale parameter = `r tb_sims[1,"prior_yeareffects"]`. 
```{r gamye sdplot 1a}
print(realised_all_sd_freq[[1]])
```


\newpage 

### gamye spatial
The survey wide trends, both full trajectory and the smooth only, from the spatial version of the gamye model using half t-distribution with 0 mean, sd = `r tb_sims[2,"prior_time"]`, and 3 degrees of freedom for the standard deviation of the spline parameters that control the wiggliness of the mean population smooth, and the same prior for the spatial variation among strata on the spline parameters. The standard deviation of the year-effects were given a gamma prior with shape parameter = 2 and scale parameter = `r tb_sims[2,"prior_yeareffects"]`. 
```{r gamye sdplot 2a}
print(realised_all_sd_freq[[2]])
```


\newpage 

### first difference non hierarchical
The survey wide trends, from the non hierarchical version of the first difference model using half t-distribution with 0 mean, sd = `r tb_sims[3,"prior_sd_time"]`, and 3 degrees of freedom for the standard deviation of the annual differences in abundance in a given stratum. 
```{r gamye sdplot 3a}
print(realised_all_sd_freq[[3]])
```


\newpage 

### first difference non spatial
The survey wide trends, from the non spatial version of the first difference model using half t-distribution with 0 mean, sd = `r tb_sims[4,"prior_time"]`, and 3 degrees of freedom for the standard deviation of the mean overall annual differences in abundance, and a half t-distribution with a sd = `r tb_sims[4,"prior_sd_time"]` on the variation among strata in the differences. 
```{r gamye sdplot 4a}
print(realised_all_sd_freq[[4]])
```


\newpage 

### first difference non spatial
The survey wide trends, from the non spatial version of the first difference model using half t-distribution with 0 mean, sd = `r tb_sims[5,"prior_time"]`, and 3 degrees of freedom for the standard deviation of the mean overall annual differences in abundance, and a half t-distribution with a sd = `r tb_sims[5,"prior_sd_time"]` on the spatial variation among strata on the differences. 
```{r gamye sdplot 5a}
print(realised_all_sd_freq[[5]])
```


